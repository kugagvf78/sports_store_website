const m=document.querySelector('meta[name="csrf-token"]')?.content;function f(){const s=document.querySelector('input[name="search"]');s&&(s.value=""),document.getElementById("filterForm")?.submit()}window.clearSearch=f;document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll('select[name="brand"], select[name="category"], select[name="sort"], select[name="order"]').forEach(function(e){e.addEventListener("change",function(){const t=document.querySelector('button[type="submit"]');t.innerHTML,t.innerHTML='<i class="fas fa-spinner fa-spin mr-2"></i>Đang tải...',t.disabled=!0,document.getElementById("filterForm").submit()})});const o=document.querySelector('input[name="search"]');o&&o.addEventListener("keypress",function(e){e.key==="Enter"&&(e.preventDefault(),document.getElementById("filterForm").submit())}),document.querySelectorAll(".group").forEach(function(e){const t=e.querySelector('a[href*="products"]');t&&t.addEventListener("click",function(){const r=this.querySelector("i");r&&(r.className="fas fa-spinner fa-spin mr-1"),this.classList.add("opacity-75")})}),document.querySelectorAll(".toggle-wishlist").forEach(e=>{e.addEventListener("click",async function(t){t.preventDefault(),t.stopPropagation();const r=this.dataset.productId,a=this.querySelector("i");try{const c=await(await fetch("/wishlist/toggle",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":m},body:JSON.stringify({product_id:r})})).json();c.success?(c.isInWishlist?(a.classList.remove("far"),a.classList.add("fas"),this.classList.add("animate-pulse"),setTimeout(()=>{this.classList.remove("animate-pulse")},1e3),showNotification("Đã thêm vào yêu thích!","success")):(a.classList.remove("fas"),a.classList.add("far"),showNotification("Đã xóa khỏi yêu thích!","info")),p(c.wishlistCount)):c.redirect?(showNotification(c.message,"error"),setTimeout(()=>{window.location.href=c.redirect},1500)):showNotification(c.message,"error")}catch(d){console.error("Error:",d),showNotification("Có lỗi xảy ra, vui lòng thử lại","error")}})}),h(),document.querySelectorAll(".pagination a").forEach(function(e){e.addEventListener("click",function(){const t=document.querySelector(".grid.grid-cols-1.md\\:grid-cols-2.xl\\:grid-cols-3");t&&t.scrollIntoView({behavior:"smooth",block:"start"})})});const u=document.getElementById("filterForm");u&&u.addEventListener("submit",function(){window.innerWidth<1024&&setTimeout(()=>{const e=document.querySelector(".flex-1");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},100)}),y(),document.addEventListener("keydown",function(e){if((e.ctrlKey||e.metaKey)&&e.key==="k"){e.preventDefault();const t=document.querySelector('input[name="search"]');t&&(t.focus(),t.select())}if(e.key==="Escape"){const t=document.querySelector('input[name="search"]');t&&document.activeElement===t&&t.blur()}})});async function h(){const s=document.querySelectorAll(".toggle-wishlist");if(s.length!==0)for(const o of s){const n=o.dataset.productId,i=o.querySelector("i");try{(await(await fetch("/wishlist/check",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":m},body:JSON.stringify({product_id:n})})).json()).isInWishlist&&(i.classList.remove("far"),i.classList.add("fas"))}catch(l){console.debug("Wishlist check skipped:",l)}}}function p(s){document.querySelectorAll(".wishlist-count").forEach(n=>{n.textContent=s,n.classList.add("scale-125"),setTimeout(()=>{n.classList.remove("scale-125")},300)})}function y(){const s=[],o=new URLSearchParams(window.location.search);o.get("search")&&s.push("Tìm kiếm"),o.get("brand")&&s.push("Thương hiệu"),o.get("category")&&s.push("Danh mục");const n=document.querySelector(".text-red-600");if(s.length>0&&n){const i=document.createElement("span");i.className="ml-2 bg-red-100 text-red-800 text-xs font-medium px-2 py-1 rounded-full",i.textContent=s.length,n.querySelector(".bg-red-100")||n.appendChild(i)}}
